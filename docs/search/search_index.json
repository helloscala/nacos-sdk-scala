{"docs":[{"location":"/paradox.json","text":"","title":""},{"location":"/index.html","text":"","title":"Nacos SDK for Scala"},{"location":"/index.html#nacos-sdk-for-scala","text":"Quick Start 依赖 编程使用 HOCON 配置 服务自动注册 HOCON 完整配置 示例 Akka Discovery 依赖 配置 示例 Play WS 依赖 使用 - 依赖注入 使用 - 手动创建","title":"Nacos SDK for Scala"},{"location":"/quickstart.html","text":"","title":"Quick Start"},{"location":"/quickstart.html#quick-start","text":"Nacos SDK for Scala 基于 Java 客户端 nacos-client 做了封装，使得在 Scala 下更易使用。支持使用 HOCON 做为配置文件，支持 Akka Discovery 和 Play-WS。","title":"Quick Start"},{"location":"/quickstart.html#依赖","text":"要在项目中使用，请添加以下依赖：\nsbt libraryDependencies += \"me.yangbajing.nacos4s\" %% \"nacos-client-scala\" % \"1.2.1\" Maven <dependency>\n  <groupId>me.yangbajing.nacos4s</groupId>\n  <artifactId>nacos-client-scala_2.12</artifactId>\n  <version>1.2.1</version>\n</dependency> Gradle dependencies {\n  compile group: 'me.yangbajing.nacos4s', name: 'nacos-client-scala_2.12', version: '1.2.1'\n}\n并添加以下依赖源：\nresolvers += Resolver.bintrayRepo(\"helloscala\", \"maven\")","title":"依赖"},{"location":"/quickstart.html#编程使用","text":"","title":"编程使用"},{"location":"/quickstart.html#nacos4snamingservice","text":"import yangbajing.nacos4s.client.naming.Nacos4sNamingService\nimport yangbajing.nacos4s.client.util.Nacos4s\n\nobject NamingDemo extends App {\n  val namingService: Nacos4sNamingService = Nacos4s.namingService(\"127.0.0.0:8848\", \"\")\n  val status = namingService.getServerStatus\n  assert(status == \"UP\")\n}","title":"Nacos4sNamingService"},{"location":"/quickstart.html#nacos4sconfigservice","text":"import yangbajing.nacos4s.client.config.Nacos4sConfigService\nimport yangbajing.nacos4s.client.util.Nacos4s\n\nobject ConfigDemo extends App {\n  val configService: Nacos4sConfigService = Nacos4s.configService(\"127.0.0.0:8848\", \"\")\n  val status = configService.getServerStatus\n  assert(status == \"UP\")\n}","title":"Nacos4sConfigService"},{"location":"/quickstart.html#hocon-配置","text":"Nacos4s 支持使用 HOCON 作为配置文件。\napplication.conf\nnacos4s.client {\n  naming {\n    serverAddr = \"127.0.0.1:8848\"\n    namespace = \"\"\n    autoRegisterInstance = on # true\n    serviceName = \"me.yangbajing.nacos4s\"\n    ip = \"127.0.0.1\"\n    port = 9999\n  }\n  config {\n    serverAddr = \"127.0.0.1:8848\"\n    namespace = \"\"\n  }\n}\n代码\nval configService = Nacos4s.configService(ConfigFactory.load().getConfig(\"nacos4s.client.config\"))\nval namingService = Nacos4s.namingService(ConfigFactory.load().getConfig(\"nacos4s.client.config\"))","title":"HOCON 配置"},{"location":"/quickstart.html#服务自动注册","text":"在使用 ConfigFactory 初始化 Nacos4sNamingService 时设置 autoRegisterInstance = on 可自动将服务注册到 Nacos。","title":"服务自动注册"},{"location":"/quickstart.html#hocon-完整配置","text":"nacos4s.client.naming {\n  // 是否自动注册服务到 Nacos\n  autoRegisterInstance = false\n\n  // 注册服务组\n  group = \"DEFAULT_GROUP\"\n\n  // 连接超时\n  timeoutMs = 30.seconds\n\n  // Nacos 地址\n  serverAddr = \"127.0.0.1:8849\"\n\n  // Nacos 名字空间\n  namespace = \"me.yangbajing.nacos\"\n\n  // 注册服务名\n  serviceName = \"161e415e-56a5-4eeb-9897-f84a268caa58\"\n\n  // 注册服务IP，默认读取本机第一个外网地址。\n  // 若读取失败建议手动设置\n  #ip = \"127.0.0.1\"\n\n  // 注册服务端口\n  port = 8080\n}","title":"HOCON 完整配置"},{"location":"/quickstart.html#示例","text":"更多 Nacos4sConfigService 使用示例见 测试 ：\nprivate val configService = Nacos4s.configService(ConfigFactory.parseString(\"\"\"{\n    |  serverAddr = \"127.0.0.1:8848\"\n    |  namespace = \"\"\n    |}\"\"\".stripMargin))\nprivate val dataId = \"me.yangbajing.nacos4s\"\nprivate val group = \"DEFAULT_GROUP\"\nprivate val timeoutMs = 30000\n\n\"ConfigService\" should {\n  val listener = new AbstractListener {\n    override def receiveConfigInfo(configInfo: String): Unit = {\n      println(s\"[${OffsetDateTime.now()}] Received new config is:\\n$configInfo\")\n    }\n  }\n  \"getServerStatus\" in {\n    configService.getServerStatus shouldBe \"UP\"\n  }\n\n  \"addListener\" in {\n    configService.addListener(dataId, group, listener)\n  }\n\n  \"publishConfig\" in {\n    val content = \"\"\"nacos4s.client {\n                    |  serverAddr = \"127.0.0.1:8848\"\n                    |  namespace = \"\"\n                    |  serviceName = \"me.yangbajing.nacos4s\"\n                    |}\"\"\".stripMargin\n    configService.publishConfig(dataId, group, content) shouldBe true\n    TimeUnit.SECONDS.sleep(1)\n  }\n\n  \"getConfig\" in {\n    val content = configService.getConfig(dataId, group, timeoutMs)\n    content should include(\"\"\"serverAddr = \"127.0.0.1:8848\"\"\"\")\n  }\n\n  \"removeConfig\" in {\n    TimeUnit.SECONDS.sleep(1)\n    configService.removeConfig(dataId, group) shouldBe true\n  }\n\n  \"removeListener\" in {\n    TimeUnit.SECONDS.sleep(1)\n    configService.removeListener(dataId, group, listener)\n  }\n}\n更多 Nacos4sNamingService 使用示例见 测试 ：\nprivate val namingService = Nacos4s.namingService(ConfigFactory.parseString(s\"\"\"{\n  |  serverAddr = \"127.0.0.1:8848\"\n  |  namespace = \"\"\n  |  autoRegisterInstance = true\n  |  serviceName = \"me-auto-register\"\n  |  port = 9999\n  |}\"\"\".stripMargin))\nprivate val serviceName = \"me.yangbajing.nacos4s\"\nprivate val group = \"DEFAULT_GROUP\"\nprivate val ip = \"127.0.0.1\"\nprivate val port = 8888\n\n\"Nacos4sNamingService\" should {\n  \"getServerStatus\" in {\n    namingService.getServerStatus shouldBe \"UP\"\n    TimeUnit.SECONDS.sleep(1)\n  }\n\n  \"getAllInstances\" in {\n    val insts = namingService.getAllInstances(\"me-auto-register\")\n    insts.foreach(println)\n    insts should have length 1\n  }\n\n  \"registerInstance\" in {\n    namingService.registerInstance(serviceName, group, ip, port)\n    TimeUnit.SECONDS.sleep(1)\n    val inst = namingService.selectOneHealthyInstance(serviceName)\n    inst should not be null\n    inst.isHealthy shouldBe true\n    inst.isEnabled shouldBe true\n    inst.isEphemeral shouldBe true\n    inst.getServiceName shouldBe s\"$group@@$serviceName\"\n    println(inst)\n  }\n}","title":"示例"},{"location":"/akka-discovery.html","text":"","title":"Akka Discovery"},{"location":"/akka-discovery.html#akka-discovery","text":"适用于基于 Akka 的程序使用。","title":"Akka Discovery"},{"location":"/akka-discovery.html#依赖","text":"要在项目中使用，请添加以下依赖：\nsbt libraryDependencies += \"me.yangbajing.nacos4s\" %% \"nacos-akka\" % \"1.2.1\" Maven <dependency>\n  <groupId>me.yangbajing.nacos4s</groupId>\n  <artifactId>nacos-akka_2.12</artifactId>\n  <version>1.2.1</version>\n</dependency> Gradle dependencies {\n  compile group: 'me.yangbajing.nacos4s', name: 'nacos-akka_2.12', version: '1.2.1'\n}","title":"依赖"},{"location":"/akka-discovery.html#配置","text":"配置 Akka Discovery 使用 Nacos4sNamingService\nakka.discovery {\n  method = nacos\n  nacos {\n    // 实现了ServiceDiscovery的服务发现类完整路径\n    class = yangbajing.nacos4s.akka.NacosServiceDiscovery\n\n    // 只返回健康实例\n    onlyHealth = true\n\n    // 只返回一个健康实例\n    oneHealth = true\n\n    namingConfig = nacos4s.client.naming\n  }\n}\nnacos4s.client.naming 配置见： nacos4s.client.naming","title":"配置"},{"location":"/akka-discovery.html#示例","text":"更多使用示例见 测试\nclass NacosServiceDiscoveryTest extends ScalaTestWithActorTestKit(\"\"\"\nakka.actor.testkit.typed {\n  default-timeout = 10.seconds\n}\nakka.discovery {\n  method = nacos\n  nacos {\n    onlyHealth = true\n    oneHealth = true\n  }\n}\nnacos4s.client.naming {\n  serverAddr = \"127.0.0.1:8848\"\n  namespace = \"\"\n  autoRegisterInstance = true\n  serviceName = \"me-auto-register\"\n  port = 9999\n}\"\"\".stripMargin) with AnyWordSpecLike {\n  \"NacosServiceDiscovery\" should {\n    \"lookup\" in {\n      val resolved = Discovery(system).discovery.lookup(\"me-auto-register\", 10.seconds).futureValue\n      println(resolved)\n      resolved.serviceName shouldBe \"me-auto-register\"\n      resolved.addresses should not be empty\n      val address = resolved.addresses.head\n      address.port shouldBe Some(9999)\n    }\n  }\n}","title":"示例"},{"location":"/play-ws.html","text":"","title":"Play WS"},{"location":"/play-ws.html#play-ws","text":"","title":"Play WS"},{"location":"/play-ws.html#依赖","text":"要在项目中使用，请添加以下依赖：\nsbt libraryDependencies += \"me.yangbajing.nacos4s\" %% \"nacos-play-ws\" % \"1.2.1\" Maven <dependency>\n  <groupId>me.yangbajing.nacos4s</groupId>\n  <artifactId>nacos-play-ws_2.12</artifactId>\n  <version>1.2.1</version>\n</dependency> Gradle dependencies {\n  compile group: 'me.yangbajing.nacos4s', name: 'nacos-play-ws_2.12', version: '1.2.1'\n}","title":"依赖"},{"location":"/play-ws.html#使用-依赖注入","text":"并在 application.conf 配置文件中启用 NacosWSModule 模块。\nplay.modules {\n  enabled += \"yangbajing.nacos4s.play.ws.scaladsl.Nacos4sWSModule\"\n  enabled += \"yangbajing.nacos4s.play.ws.javadsl.Nacos4sWSModule\"\n}\n与原生的 play-ws 使用唯一的区别就是在 Inject 时添加 @Named(\"nacos\") 注解。\nScala API\nimport javax.inject.{ Inject, Named }\nimport play.api.libs.ws.WSClient\n\nclass NacosWSClientController @Inject() (@Named(\"nacos\") wsClient: WSClient) {\n  def page = {\n    val req = wsClient.url(\"http://example-service/api/health\")\n  }\n}\nJava API\nimport play.libs.ws.WSClient;\nimport play.libs.ws.WSRequest;\n\nimport javax.inject.Inject;\nimport javax.inject.Named;\n\npublic class NacosWSClientController {\n    private final WSClient wsClient;\n\n    @Inject\n    public NacosWSClientController(@Named(\"nacos\") WSClient wsClient) {\n        this.wsClient = wsClient;\n    }\n\n    public void index() {\n        WSRequest req = wsClient.url(\"http://example-service/api/health\");\n    }\n}","title":"使用 - 依赖注入"},{"location":"/play-ws.html#使用-手动创建","text":"Scala API\nval wsClient = NacosWSClient(StandaloneAhcWSClient())\nval response = wsClient.url(\"https://github.com/yangbajing/nacos-sdk-scala\").get().futureValue\nresponse.status shouldBe 200\nwsClient.close()\nJava API\nval ahcWSClient = new StandaloneAhcWSClient(new DefaultAsyncHttpClient(), SystemMaterializer(system).materializer)\nval wsClient = new NacosWSClient(system, ahcWSClient)\nval response = wsClient.url(\"https://github.com/yangbajing/nacos-sdk-scala\").get().toScala.futureValue\nresponse.getStatus shouldBe 200\nwsClient.close()","title":"使用 - 手动创建"}]}